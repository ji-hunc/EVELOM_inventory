# 배치코드 기반 재고관리 시스템 설정 가이드

## 🎯 개요
기존 UUID 기반 시스템을 **배치코드 기반 재고관리 시스템**으로 완전히 재구성했습니다.

## 📦 배치코드란?
- **형식**: 4자리 숫자 + 선택적 알파벳 (예: `4030`, `4030A`)
- **구성**:
  - 첫 번째 자리: 생산 연도의 마지막 자리 (4 = 2024년)
  - 2-4번째 자리: 해당 연도의 일자 (001-366)
- **예시**: 
  - `4030` = 2024년 1월 30일 생산
  - `4045A` = 2024년 2월 14일 생산 (A 배치)
- **유통기한**: 생산일로부터 **3년**

## 🔄 데이터베이스 재생성 절차

### 1. Supabase SQL Editor에서 실행
```sql
-- database-recreate-with-batch.sql 파일 내용을 복사하여 실행
-- ⚠️ 주의: 기존 모든 데이터가 삭제됩니다!
```

### 2. 주요 변경사항
- **Primary Keys**: UUID → name/username
- **배치코드 필드 추가**: `batch_code`, `production_date`, `expiry_date`
- **자동 계산**: 배치코드 입력 시 생산일과 유통기한 자동 계산
- **유통기한 뷰**: 만료 상태별 재고 현황 자동 분류

## 📊 새로운 기능

### 1. 배치코드 기반 재고 관리
```typescript
// 같은 상품이라도 배치코드별로 구분 관리
{
  product_id: "클렌징밤 100ml",
  location_id: "창고",
  batch_code: "4030",     // 2024-01-30 생산
  current_stock: 100,
  production_date: "2024-01-30",
  expiry_date: "2027-01-30"
}
```

### 2. 유통기한 상태 자동 분류
- 🔴 **만료**: 유통기한 지남
- 🟠 **30일 이내 만료**: 30일 이내 만료 예정
- 🟡 **90일 이내 만료**: 90일 이내 만료 예정
- 🟢 **정상**: 정상 상태

### 3. 유틸리티 함수 (`src/lib/batch-utils.ts`)
```typescript
// 배치코드 → 생산일자
parseBatchCodeToDate("4030") // 2024-01-30

// 유통기한 상태 확인
getExpiryStatus(expiryDate) // "30일 이내 만료"

// 배치코드 유효성 검사
validateBatchCode("4030A") // true
```

## 🎨 UI 컴포넌트 업데이트 (예정)

### 1. 재고 테이블에 추가될 컬럼
- **배치코드**: 4030, 4030A 등
- **생산일**: 2024-01-30
- **유통기한**: 2027-01-30
- **상태**: 만료/30일 이내 만료/90일 이내 만료/정상

### 2. 필터링 기능
- 유통기한 상태별 필터
- 만료 임박 재고 알림
- 배치코드별 검색

### 3. 알림 시스템
- 90일 이내 만료 예정 상품 알림
- 만료된 상품 강조 표시

## 🔍 데이터베이스 구조

### 테이블 관계
```
categories (name PK)
├── products (name PK, category_id FK)
    └── inventory (id UUID PK, product_id FK, location_id FK, batch_code)
        └── inventory_movements (id UUID PK, product_id FK, location_id FK, batch_code)

locations (name PK)
├── inventory (location_id FK)
└── users (assigned_location_id FK)

users (username PK)
```

### 자동 계산 트리거
- 배치코드 입력 → 생산일자 자동 계산
- 생산일자 → 유통기한 자동 계산 (3년 후)

### 편의 뷰 (Views)
- `inventory_with_expiry_status`: 유통기한 상태 포함 재고 현황
- `expiring_inventory_alert`: 만료 임박 재고 알림

## 🧪 테스트 데이터
데이터베이스 재생성 후 다음 샘플 데이터가 자동 입력됩니다:

| 상품 | 위치 | 배치코드 | 생산일 | 유통기한 | 재고 |
|------|------|----------|--------|----------|------|
| 클렌징밤 450ml | 창고 | 4030 | 2024-01-30 | 2027-01-30 | 50 |
| 클렌징밤 450ml | 창고 | 4045A | 2024-02-14 | 2027-02-14 | 25 |
| 모이스처크림 8ml | 창고 | 4060 | 2024-02-29 | 2027-02-29 | 200 |

## ⚠️ 중요 참고사항

1. **데이터 손실**: 기존 모든 데이터가 삭제됩니다
2. **배치코드 필수**: 모든 재고는 배치코드가 필요합니다
3. **중복 방지**: 같은 상품/위치/배치코드 조합은 유니크합니다
4. **권한 시스템**: RLS(Row Level Security) 적용으로 보안 강화

## 🚀 다음 단계

1. **데이터베이스 재생성** (`database-recreate-with-batch.sql` 실행)
2. **UI 컴포넌트 업데이트** (배치코드 필드 추가)
3. **유통기한 알림 시스템** 구현
4. **배치코드 기반 필터링** 기능 추가

이제 제품의 생산일과 유통기한을 체계적으로 관리할 수 있는 완전한 배치코드 기반 재고관리 시스템이 준비되었습니다! 🎉